<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MaterialsTable">
    <resultMap type="MaterialsTable" id="materialsTableMap">
		<id column="materials_table_id" property="materialsTableId"/>
		<result column="materials_table_code" property="materialsTableCode"/>
		<result column="design_org_id" property="designOrgId"/>
		<result column="design_org_name" property="designOrgName"/>
		<result column="materials_table_state" property="materialsTableState"/>
		<result column="materials_table_type" property="materialsTableType"/>
		<result column="create_time" property="createTime"/>
		<result column="create_user_id" property="createUserId"/>
		<result column="create_user_name" property="createUserName"/>
		<result column="is_match" property="isMatch"/>
	</resultMap>
    <sql id="column">
    	mt.materials_table_id,mt.materials_table_code,
    	mt.design_org_id,mt.design_org_name,mt.materials_table_state,
    	mt.materials_table_type,mt.create_user_name,mt.create_user_id,mt.create_time
    </sql> 
    <!-- 根据条件分页查询条目 -->
	<select id="selectByCondition" resultMap="materialsTableMap" parameterType="map">
		select * from(
			select 
			mt.materials_table_id,mt.materials_table_code,
	    	mt.design_org_id,mt.design_org_name,
	    	mt.materials_table_type,
	    	mt.materials_table_state,mt.create_user_name,mt.create_user_id,mt.create_time,
			mt.is_match,
			ROW_NUMBER() OVER(order by mt.create_time) r
			from d_materials_table mt
			<where>
				1=1
				<if test="MaterialsTableCondition.materialsTableCode!=null and MaterialsTableCondition.materialsTableCode!=''">
					and mt.materials_table_code = #{MaterialsTableCondition.materialsTableCode}
				</if>
				<if test="MaterialsTableCondition.designOrgId!=null and MaterialsTableCondition.designOrgId!=''">
					and mt.design_org_id = #{MaterialsTableCondition.designOrgId}
				</if>
				<if test="MaterialsTableCondition.materialsTableType!=null and MaterialsTableCondition.materialsTableType!=''">
					and mt.materials_table_type = #{MaterialsTableCondition.materialsTableType}
				</if>
				<if test="MaterialsTableCondition.startCreatTime != null">
					and mt.create_time &gt;= #{MaterialsTableCondition.startCreatTime}
				</if>
				<if test="MaterialsTableCondition.endCreatTime != null">
					and mt.create_time &lt;= #{MaterialsTableCondition.endCreatTime}
				</if>
				<if test="MaterialsTableCondition.designOrgs!=null and MaterialsTableCondition.designOrgs.size>0">
					and mt.design_org_id in
					<foreach collection="MaterialsTableCondition.designOrgs" index="index" item="designOrg" open="(" separator="," close=")">
						#{designOrg.orgId}
					</foreach>
				</if>
			</where>
		) s
		where s.r between #{page.startPos} and ((#{page.pageSize}+#{page.startPos})-1)
	</select>  
	<!-- 根据条件查询条目数 -->
	<select id="countByCondition" resultType="int" parameterType="map">
		select count(*) from d_materials_table mt
		<where>
			1=1
			<if test="MaterialsTableCondition.materialsTableCode!=null and MaterialsTableCondition.materialsTableCode!=''">
				and mt.materials_table_code = #{MaterialsTableCondition.materialsTableCode}
			</if>
			<if test="MaterialsTableCondition.designOrgId!=null and MaterialsTableCondition.designOrgId!=''">
				and mt.design_org_id = #{MaterialsTableCondition.designOrgId}
			</if>
			<if test="MaterialsTableCondition.materialsTableType!=null and MaterialsTableCondition.materialsTableType!=''">
				and mt.materials_table_type = #{MaterialsTableCondition.materialsTableType}
			</if>
			<if test="MaterialsTableCondition.startCreatTime != null">
				and mt.create_time &gt;= #{MaterialsTableCondition.startCreatTime}
			</if>
			<if test="MaterialsTableCondition.endCreatTime != null">
				and mt.create_time &lt;= #{MaterialsTableCondition.endCreatTime}
			</if>
			<if test="MaterialsTableCondition.designOrgs!=null and MaterialsTableCondition.designOrgs.size>0">
				and mt.design_org_id in
				<foreach collection="MaterialsTableCondition.designOrgs" index="index" item="designOrg" open="(" separator="," close=")">
					#{designOrg.orgId}
				</foreach>
			</if>
		</where>
	</select>
	<!-- 根据ID查询单个实体 -->
	<select id="selectByPk" resultMap="materialsTableMap" parameterType="string">
		select * from d_materials_table mt where  mt.materials_table_id = #{materialsTableId}
	</select>
	<!-- 插入一个实体 -->
	<insert id="insert" parameterType="MaterialsTable" useGeneratedKeys="false">
		insert into d_materials_table(
			materials_table_id,materials_table_code,design_org_id,design_org_name,
			materials_table_state,materials_table_type,create_user_name,create_user_id,create_time, is_match
		) values(
			#{materialsTableId}, #{materialsTableCode}, #{designOrgId}, #{designOrgName},
			#{materialsTableState}, #{materialsTableType}, #{createUserName}, #{createUserId}, #{createTime}, #{isMatch}
		)
	</insert>
	
	<!-- 更新状态 -->
	<update id="update" parameterType="MaterialsTable">
		update d_materials_table
		<set>
			<if test="materialsTableState!=null and materialsTableState!=''">materials_table_state = #{materialsTableState},</if>
			<if test="isMatch!=null and isMatch!=''">is_match = #{isMatch}</if>
		</set>
		where materials_table_id = #{materialsTableId}
	</update>

	<!-- 根据ID删除条目 -->
	<delete id="delete" parameterType="string">
		delete from d_materials_table where materials_table_id = #{materialsTableId}
	</delete>
	
</mapper>