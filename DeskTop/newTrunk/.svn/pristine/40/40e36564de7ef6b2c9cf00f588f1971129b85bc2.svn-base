<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

	<mapper namespace="OrganizationRole" >
		<resultMap type="OrganizationRole" id="orgRoleMap">
			<association property="organization" resultMap="Organization.organizationMap" ></association>
			<association property="role" resultMap="Role.roleMap" ></association>
		</resultMap>
		
		<!-- 批量插入组织机构类型表 -->
		<insert id="insertList" parameterType="java.util.List" useGeneratedKeys="false">
			insert into sys_org_role
			(org_id,role_id)
			SELECT A.*
			FROM(
			<foreach collection="list" item="item" index="index" separator="UNION ALL">
				(SELECT 
				#{item.organization.orgId} org_id,
				#{item.role.roleId} role_id
				FROM dual)
			</foreach>
			)A 
		</insert>
		<!-- 根据组织机构id查询已选择的角色 -->
		<select id="selectCheckRoleByOrg" resultMap="orgRoleMap">
			select distinct sr.role_id,sr.role_name,sr.role_code,so.org_id from sys_org_role sor
			left join sys_role sr on sor.role_id = sr.role_id
			left join sys_org so on sor.org_id = so.org_id
			<where>
				<if test="orgId != null and orgId != ''">
					sor.org_id = #{orgId}
				</if>
			</where>
			order by sr.role_code
		</select>
		
		<!-- 删除组织机构角色信息 -->
		<delete id="deleteOrgRole" parameterType="OrganizationRole">
			delete from sys_org_role 
			<where>
				org_id=#{organization.orgId} and role_id=#{role.roleId}
			</where>
		</delete>
	</mapper>
