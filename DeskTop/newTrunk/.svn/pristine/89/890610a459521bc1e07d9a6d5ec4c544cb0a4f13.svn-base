<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="AgreementSupplier" >
    <resultMap id="agreementSupplierMap" type="AgreementSupplier" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Feb 21 09:29:13 GMT+08:00 2017.
        -->
        <result column="source_state" property="sourceState"  />
        <result column="source_id" property="sourceId"  />
        <result column="supplier_org_id" property="supplierOrgId"  />
        <result column="supplier_agreement_code" property="supplierAgreementCode"  />
        <result column="org_name" property="orgName"  />
        <result column="org_code" property="orgCode"  />
    </resultMap>
    <sql id="column">source_state,source_id,supplier_org_id,supplier_agreement_code</sql>
    <!-- 查询全部条目 -->
    <select id="selectAll" resultMap="agreementSupplierMap">
        select * from p_procurement_supplier
    </select>
    <!-- 根据条件查询条目 -->
    <select id="selectByCondition" resultMap="agreementSupplierMap" parameterType="map">
        select * from(
        select pp.supplier_org_id,so.org_name,so.org_code,pp.supplier_agreement_code
        from p_procurement_supplier pp
        LEFT JOIN sys_org so ON  so.org_id=pp.supplier_org_id
        LEFT JOIN p_framework_agreement a ON a.agreement_id=pp.source_id
        <where>

            <if test="AgreementSupplierCondition!=null">
                <if test="AgreementSupplierCondition.sourceId!=null and AgreementSupplierCondition.sourceId!=''">
                    and source_id = #{AgreementSupplierCondition.sourceId}
                </if>
                <if test="AgreementSupplierCondition.supplierOrgId!=null and AgreementSupplierCondition.supplierOrgId!=''">
                    and supplier_org_id = #{AgreementSupplierCondition.supplierOrgId}
                </if>
                <if test="AgreementSupplierCondition.supplierAgreementCode!=null and AgreementSupplierCondition.supplierAgreementCode!=''">
                    and supplier_agreement_code = #{AgreementSupplierCondition.supplierAgreementCode}
                </if>
                <if test="AgreementSupplierCondition.agreementSupplierList != null and AgreementSupplierCondition.agreementSupplierList.size>0">
                    and
                    pp.source_id in
                    <foreach collection="AgreementSupplierCondition.agreementSupplierList" item="item" open="("
                             close=")" separator=",">
                        #{item}
                    </foreach>
                </if>
            </if>
        </where>
        )
    </select>

    <insert id="insert" parameterType="AgreementSupplier" useGeneratedKeys="false">
        insert into p_procurement_supplier(
       source_state,source_id,supplier_org_id,supplier_agreement_code
        ) values(
        #{sourceState}, #{sourceId}, #{supplierOrgId},
        #{supplierAgreementCode}
        )
    </insert>
    <!-- 更新一个实体 -->
    <update id="update" parameterType="AgreementSupplier" >
        update p_procurement_supplier
        <set>
            <if test="AgreementSupplier!=null">
                <if test="supplierOrgId!=null and supplierOrgId!=''">
                    and supplier_org_id = #{supplierOrgId}
                </if>
                <if test="sourceState!=null and sourceState!=''">
                    and source_state = #{sourceState}
                </if>
                <if test="supplierAgreementCode!=null and supplierAgreementCode!=''">
                    and supplier_agreement_code = #{supplierAgreementCode}
                </if>

            </if>
        </set>

    </update>

    <insert id="insertList" parameterType="java.util.List" useGeneratedKeys="false">
        insert into  p_procurement_supplier
        (
            source_state,source_id,supplier_org_id,supplier_agreement_code
        )
        SELECT A.*
        FROM(
        <foreach collection="list" item="item" index="index" separator="UNION ALL">
            (SELECT
            'kuangjia' source_state,#{item.sourceId} source_id,
            #{item.supplierOrgId} supplier_org_id,#{item.supplierAgreementCode} supplier_agreement_code

            FROM dual)
        </foreach>
        )A
    </insert>

    <!-- 根据组织机构id删除组织机构类型表 -->
    <delete id="delete" parameterType="string">
        delete  from p_procurement_supplier
        where
           source_id = #{agreementId}

    </delete>

</mapper>