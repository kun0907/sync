<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ReceiptGoods">
    <resultMap type="ReceiptGoods" id="receiptGoodsMap">
        <id column="receipt_id" property="receiptId"/>
        <result column="receipt_code" property="receiptCode"/>
        <result column="receipt_state" property="receiptState"/>
        <result column="arrive_time" property="arriveTime"/>
        <result column="create_time" property="createTime"/>
        <result column="create_user_id" property="createUserId"/>
        <result column="create_user_name" property="createUserName"/>
        <result column="supplier_name" property="supplierName"/>
        <result column="supplier_id" property="supplierId"/>
        <result column="delivery_id" property="deliveryId"/>
        <result column="receipt_type" property="receiptType"/>
        <result column="delivery_no" property="deliveryNo"/>
        <result column="order_no_seq" property="orderNoSeq"/>
        <result column="receipt_org_id" property="receiptOrgId"/>
    </resultMap>
    <!-- 根据条件分页查询条目 -->
    <select id="selectByCondition" resultMap="receiptGoodsMap" parameterType="map">
        select * from(
        select
        receipt_id,receipt_code,receipt_state,arrive_time,create_time,create_user_id,receipt_org_id,
        create_user_name,supplier_name,supplier_id,delivery_id,receipt_type,delivery_no,order_no_seq,
        ROW_NUMBER() OVER(order by ru.create_time desc) r
        from
        ru_goods_receipt ru
        <where>
            1=1
            <if test="ReceiptGoodsCondition!=null">
                <if test="ReceiptGoodsCondition.receiptState != null and ReceiptGoodsCondition.receiptState != ''">
                    and receipt_state = #{ReceiptGoodsCondition.receiptState}
                </if>
                <if test="ReceiptGoodsCondition.createStartTime != null ">
                    and create_time &gt;= #{ReceiptGoodsCondition.createStartTime}
                </if>
                <if test="ReceiptGoodsCondition.createEndTime != null ">
                    and create_time &lt;= #{ReceiptGoodsCondition.createEndTime}
                </if>
                <if test="ReceiptGoodsCondition.receiptCode != null and ReceiptGoodsCondition.receiptCode != ''">
                    and receipt_code = #{ReceiptGoodsCondition.receiptCode}
                </if>
                <if test="ReceiptGoodsCondition.supplierName != null and ReceiptGoodsCondition.supplierName != ''">
                    and supplier_name = #{ReceiptGoodsCondition.supplierName}
                </if>
                <if test="ReceiptGoodsCondition.createUserName != null and ReceiptGoodsCondition.createUserName != ''">
                    and create_user_name = #{ReceiptGoodsCondition.createUserName}
                </if>
                <if test="ReceiptGoodsCondition.deliveryNo != null and ReceiptGoodsCondition.deliveryNo != ''">
                    and delivery_no = #{ReceiptGoodsCondition.deliveryNo}
                </if>
                <if test="ReceiptGoodsCondition.receiptType != null and ReceiptGoodsCondition.receiptType != ''">
                    and receipt_type = #{ReceiptGoodsCondition.receiptType}
                </if>
                <if test="ReceiptGoodsCondition.inStorage != null and ReceiptGoodsCondition.inStorage != ''">
                    and in_storage = #{ReceiptGoodsCondition.inStorage}
                </if>
            </if>
        </where>
        )s
        where  s.r between #{page.startPos} and ((#{page.pageSize}+#{page.startPos})-1)
    </select>

    <!-- 根据条件查询条目数 -->
    <select id="countByCondition" resultType="int" parameterType="map">
        select count(*)
        from
        ru_goods_receipt ru
        <where>
            1=1
            <if test="ReceiptGoodsCondition!=null">
                <if test="ReceiptGoodsCondition.receiptState != null and ReceiptGoodsCondition.receiptState != ''">
                    and receipt_state = #{ReceiptGoodsCondition.receiptState}
                </if>
                <if test="ReceiptGoodsCondition.createStartTime != null ">
                    and create_time &gt;= #{ReceiptGoodsCondition.createStartTime}
                </if>
                <if test="ReceiptGoodsCondition.createEndTime != null ">
                    and create_time &lt;= #{ReceiptGoodsCondition.createEndTime}
                </if>
                <if test="ReceiptGoodsCondition.receiptCode != null and ReceiptGoodsCondition.receiptCode != ''">
                    and receipt_code = #{ReceiptGoodsCondition.receiptCode}
                </if>
                <if test="ReceiptGoodsCondition.supplierName != null and ReceiptGoodsCondition.supplierName != ''">
                    and supplier_name = #{ReceiptGoodsCondition.supplierName}
                </if>
                <if test="ReceiptGoodsCondition.createUserName != null and ReceiptGoodsCondition.createUserName != ''">
                    and create_user_name = #{ReceiptGoodsCondition.createUserName}
                </if>
                <if test="ReceiptGoodsCondition.deliveryNo != null and ReceiptGoodsCondition.deliveryNo != ''">
                    and delivery_no = #{ReceiptGoodsCondition.deliveryNo}
                </if>
                <if test="ReceiptGoodsCondition.receiptType != null and ReceiptGoodsCondition.receiptType != ''">
                    and receipt_type = #{ReceiptGoodsCondition.receiptType}
                </if>
                <if test="ReceiptGoodsCondition.inStorage != null and ReceiptGoodsCondition.inStorage != ''">
                    and in_storage = #{ReceiptGoodsCondition.inStorage}
                </if>
            </if>
        </where>
    </select>
    <delete id="delete" parameterType="string">
        delete from ru_goods_receipt where receipt_id = #{receiptId}
    </delete>
    <!-- 根据ID查询单个实体 -->
    <select id="selectByPk" resultMap="receiptGoodsMap" parameterType="string">
        select * from ru_goods_receipt where receipt_id = #{receiptId}
    </select>
    <update id="update" parameterType="ReceiptGoods">
        update ru_goods_receipt
        <set>
            receipt_code = #{receiptCode},
            delivery_no = #{deliveryNo},
            supplier_id = #{supplierId},
            <if test="receiptState!=null and receiptState!=''">receipt_state = #{receiptState},</if>
            supplier_name = #{supplierName},
            arrive_time = #{arriveTime},
            order_no_seq=#{orderNoSeq},
            receipt_org_id=#{receiptOrgId}
        </set>
        where receipt_id = #{receiptId}
    </update>
    <!-- 插入仓库信息 -->
    <insert id="insert" parameterType="Order" useGeneratedKeys="false">
        insert into ru_goods_receipt (
        receipt_id,receipt_code,
        receipt_state,arrive_time,
        create_time,create_user_id,
        create_user_name,supplier_name,
        supplier_id,delivery_id,
        receipt_type,delivery_no,
        order_no_seq,in_Storage,receipt_org_id
        ) values (
        #{receiptId},#{receiptCode},
        #{receiptState},#{arriveTime},
        #{createTime},#{createUserId},
        #{createUserName},#{supplierName},
        #{supplierId},#{deliveryId},
        #{receiptType},#{deliveryNo},
        #{orderNoSeq},#{inStorage},#{receiptOrgId}
        )
    </insert>
</mapper>