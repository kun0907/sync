<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="DrawingDetailed">

    <resultMap type="DrawingDetailed" id="DrawingDetailedMap">
		<id column="drawing_detailed_id" property="drawingDetailedId"/>
		<result column="drawing_detailed_no" property="drawingDetailedNo"/>
		<result column="materials_table_id" property="materialsTableId"/>
		<result column="materials_table_code" property="materialsTableCode"/>
		<result column="design_org_id" property="designOrgId"/>
		<result column="design_org_code" property="designOrgCode"/>
		<result column="drawing_number_id" property="drawingNumberId"/>
		<result column="drawing_number_code" property="drawingNumberCode"/>
		<result column="drawing_number_version" property="drawingNumberVersion"/>
		<result column="project_id" property="projectId"/>
		
		<result column="project_code_seq" property="projectCodeSeq"/>
		<result column="change_number" property="changeNumber"/>
		<result column="drawing_detailed_state" property="drawingDetailedState"/>
		<result column="drawing_detailed_type" property="drawingDetailedType"/>
		<result column="parent_id" property="parentId"/>
		<result column="parent_id" property="_parentId"/>
		<result column="design_id" property="designId"/>
		<result column="materials_id" property="materialsId"/>
		<result column="materials_code" property="materialsCode"/>
		<result column="design_code" property="designCode"/>
		
		<result column="design_describe" property="designDescribe"/>
		<result column="extra1" property="extra1"/>
		<result column="extra2" property="extra2"/>
		<result column="extra3" property="extra3"/>
		<result column="extra4" property="extra4"/>
		<result column="design_unit" property="designUnit"/>
		<result column="design_count" property="designCount"/>
		<result column="used_count" property="usedCount"/>
		<result column="overrun" property="overrun"/>
		<result column="total_count" property="totalCount"/>
		<result column="error_message" property="errorMessage"/>
		<result column="drawing_number_device_no" property="drawingNumberDeviceNo"/>

		<result column="unit_weight" property="unitWeight"/>
		<result column="total_weight" property="totalWeight"/>
		<result column="part_attributes" property="partAttributes"/>
		<result column="remark" property="remark"/>
	</resultMap>
	
	<sql id="column">dd.drawing_detailed_id,dd.drawing_detailed_no,dd.materials_table_id,
	                 dd.materials_table_code,dd.design_org_id,dd.design_org_code,dd.drawing_number_id,
	                 dd.drawing_number_code,dd.drawing_number_version,dd.project_id,
                     dd.project_code_seq,dd.change_number,dd.drawing_detailed_state,
                     dd.drawing_detailed_type,dd.parent_id,dd.design_id,dd.materials_id,dd.design_code,
                     dd.design_describe,dd.extra1,dd.extra2,dd.extra3,dd.extra4,dd.design_unit,
                     dd.design_count,dd.used_count,dd.error_message,dd.drawing_number_device_no
    </sql>

	<!-- 根据条件分页查询条目 -->
	<select id="selectByCondition" resultMap="DrawingDetailedMap" parameterType="map">
		select * from(
			select dd.drawing_detailed_id, dd.drawing_detailed_no, dd.materials_table_id,
			dd.materials_table_code, dd.design_org_id, dd.design_org_code, dd.drawing_number_id,
			dd.drawing_number_code, dd.drawing_number_version, dd.project_id,
			dd.project_code_seq, dd.change_number, dd.drawing_detailed_state,
			dd.drawing_detailed_type, dd.parent_id, dd.design_id, m.materials_code as materials_code, dd.materials_id, dd.design_code,
			dd.design_describe, dd.extra1, dd.extra2, dd.extra3, dd.extra4, dd.design_unit,
			dd.design_count, dd.used_count, dd.error_message, dd.drawing_number_device_no,
			overrun, total_count, error_type,
			unit_weight, total_weight, part_attributes, remark,
			ROW_NUMBER() OVER(order by dd.drawing_detailed_id) r
			from d_drawing_detailed dd
			left join d_materials_table mt on dd.materials_table_id = mt.materials_table_id
			left join b_materials m on dd.materials_id = m.materials_id
			left join b_project p on p.project_id = dd.project_id
			<where>
				mt.materials_table_state='drawingNumber' and (dd.total_count>dd.used_count or dd.used_count is null)
				<if test="DrawingDetailedCondition.drawingNumberCode!=null and DrawingDetailedCondition.drawingNumberCode!=''">
					and dd.drawing_number_code = #{DrawingDetailedCondition.drawingNumberCode}
				</if>
				<if test="DrawingDetailedCondition.materialsTableId!=null and DrawingDetailedCondition.materialsTableId!=''">
					and dd.materials_table_id = #{DrawingDetailedCondition.materialsTableId}
				</if>
				<if test="DrawingDetailedCondition.drawingDetailedState!=null and DrawingDetailedCondition.drawingDetailedState!=''" >
					and dd.drawing_detailed_state = #{DrawingDetailedCondition.drawingDetailedState}
				</if>
				<if test="DrawingDetailedCondition.designOrgId!=null and DrawingDetailedCondition.designOrgId!=''" >
					and dd.design_org_id = #{DrawingDetailedCondition.designOrgId}
				</if>
				<if test="DrawingDetailedCondition.designOrgCode!=null and DrawingDetailedCondition.designOrgCode!=''" >
					and dd.design_org_code = #{DrawingDetailedCondition.designOrgCode}
				</if>
				<if test="DrawingDetailedCondition.projectId!=null and DrawingDetailedCondition.projectId!=''" >
					and p.project_id = #{DrawingDetailedCondition.projectId}
				</if>
				<if test="DrawingDetailedCondition.designCode!=null and DrawingDetailedCondition.designCode!=''" >
					and dd.design_code = #{DrawingDetailedCondition.designCode}
				</if>
				<if test="DrawingDetailedCondition.designDescribe!=null and DrawingDetailedCondition.designDescribe!=''" >
					and dd.design_describe = #{DrawingDetailedCondition.designDescribe}
				</if>
			</where>
		) s

	</select>
    
    <!-- 根据条件查询列表不分页 -->
    <select id="selectByConditionNoPage" resultMap="DrawingDetailedMap" parameterType="map">
		select dd.drawing_detailed_id, dd.drawing_detailed_no, dd.materials_table_id,
	    	dd.materials_table_code, dd.design_org_id, dd.design_org_code, dd.drawing_number_id,
	        dd.drawing_number_code, dd.drawing_number_version, dd.project_id,
            dd.project_code_seq, dd.change_number, dd.drawing_detailed_state,
            dd.drawing_detailed_type, dd.parent_id, m.materials_code as design_id, dd.materials_id, dd.design_code,
            dd.design_describe, dd.extra1, dd.extra2, dd.extra3, dd.extra4, dd.design_unit,
            dd.design_count, dd.used_count, dd.error_message, dd.drawing_number_device_no,
			overrun, total_count, error_type,
			unit_weight, total_weight, part_attributes, remark
		from d_drawing_detailed dd
		left join d_materials_table mt on dd.materials_table_id = mt.materials_table_id
		left join b_materials m on dd.materials_id = m.materials_id
		left join b_project p on p.project_id = dd.project_id
		<where>
			1=1
			<if test="DrawingDetailedCondition.drawingNumberCode!=null and DrawingDetailedCondition.drawingNumberCode!=''">
				and mt.materials_table_state='drawingNumber' and dd.drawing_number_code = #{DrawingDetailedCondition.drawingNumberCode}
			</if>
			<if test="DrawingDetailedCondition.materialsTableId!=null and DrawingDetailedCondition.materialsTableId!=''">
				and dd.materials_table_id = #{DrawingDetailedCondition.materialsTableId}
			</if>
			<if test="DrawingDetailedCondition.drawingDetailedState!=null and DrawingDetailedCondition.drawingDetailedState!=''" >
				and dd.drawing_detailed_state = #{DrawingDetailedCondition.drawingDetailedState}
			</if>
			<if test="DrawingDetailedCondition.drawingDetailedState!=null and DrawingDetailedCondition.drawingDetailedState!=''" >
				and dd.drawing_detailed_state = #{DrawingDetailedCondition.drawingDetailedState}
			</if>
			<if test="DrawingDetailedCondition.designOrgCode!=null and DrawingDetailedCondition.designOrgCode!=''" >
				and dd.design_org_code = #{DrawingDetailedCondition.designOrgCode}
			</if>
			<if test="DrawingDetailedCondition.projectId!=null and DrawingDetailedCondition.projectId!=''" >
				and p.project_id = #{DrawingDetailedCondition.projectId}
			</if>
			<if test="DrawingDetailedCondition.designCode!=null and DrawingDetailedCondition.designCode!=''" >
				and dd.design_code = #{DrawingDetailedCondition.designCode}
			</if>
			<if test="DrawingDetailedCondition.designDescribe!=null and DrawingDetailedCondition.designDescribe!=''" >
				and dd.design_describe = #{DrawingDetailedCondition.designDescribe}
			</if>
		</where>
	</select>
	
	<!-- 根据条件查询条数 -->
	<select id="countByCondition" resultType="int" parameterType="map">
		select count(*)
		from d_drawing_detailed dd
		left join d_materials_table mt on dd.materials_table_id = mt.materials_table_id
		left join b_materials m on dd.materials_id = m.materials_id
		left join b_project p on p.project_id = dd.project_id
		<where>
			1=1
			<if test="DrawingDetailedCondition.drawingNumberCode!=null and DrawingDetailedCondition.drawingNumberCode!=''">
				and mt.materials_table_state='drawingNumber'  and dd.drawing_number_code = #{DrawingDetailedCondition.drawingNumberCode}
			</if>
			<if test="DrawingDetailedCondition.materialsTableId!=null and DrawingDetailedCondition.materialsTableId!=''">
				and dd.materials_table_id = #{DrawingDetailedCondition.materialsTableId}
			</if>
			<if test="DrawingDetailedCondition.drawingDetailedState!=null and DrawingDetailedCondition.drawingDetailedState!=''" >
				and dd.drawing_detailed_state = #{DrawingDetailedCondition.drawingDetailedState}
			</if>
		</where>
	</select>

	<!-- 根据条件查询条数 -->
	<select id="countByConditionPage" resultType="int" parameterType="map">
		select count(*) from d_drawing_detailed dd
		left join d_materials_table mt on dd.materials_table_id = mt.materials_table_id
		left join b_materials m on dd.materials_id = m.materials_id
		left join b_project p on p.project_id = dd.project_id
		<where>
			mt.materials_table_state='drawingNumber' and (dd.total_count>dd.used_count or dd.used_count is null)
			<if test="DrawingDetailedCondition.drawingNumberCode!=null and DrawingDetailedCondition.drawingNumberCode!=''">
				and dd.drawing_number_code = #{DrawingDetailedCondition.drawingNumberCode}
			</if>
			<if test="DrawingDetailedCondition.materialsTableId!=null and DrawingDetailedCondition.materialsTableId!=''">
				and dd.materials_table_id = #{DrawingDetailedCondition.materialsTableId}
			</if>
			<if test="DrawingDetailedCondition.drawingDetailedState!=null and DrawingDetailedCondition.drawingDetailedState!=''" >
				and dd.drawing_detailed_state = #{DrawingDetailedCondition.drawingDetailedState}
			</if>
			<if test="DrawingDetailedCondition.drawingDetailedState!=null and DrawingDetailedCondition.drawingDetailedState!=''" >
				and dd.drawing_detailed_state = #{DrawingDetailedCondition.drawingDetailedState}
			</if>
			<if test="DrawingDetailedCondition.designOrgCode!=null and DrawingDetailedCondition.designOrgCode!=''" >
				and dd.design_org_code = #{DrawingDetailedCondition.designOrgCode}
			</if>
			<if test="DrawingDetailedCondition.projectId!=null and DrawingDetailedCondition.projectId!=''" >
				and p.project_id = #{DrawingDetailedCondition.projectId}
			</if>
			<if test="DrawingDetailedCondition.designCode!=null and DrawingDetailedCondition.designCode!=''" >
				and dd.design_code = #{DrawingDetailedCondition.designCode}
			</if>
			<if test="DrawingDetailedCondition.designDescribe!=null and DrawingDetailedCondition.designDescribe!=''" >
				and dd.design_describe = #{DrawingDetailedCondition.designDescribe}
			</if>
		</where>
	</select>
	
	<!-- 插入一个实体 -->
	<insert id="insert" parameterType="DrawingDetailed" useGeneratedKeys="false">
		insert into d_drawing_detailed(
	        drawing_detailed_id,drawing_detailed_no,materials_table_id,
	        materials_table_code,design_org_id,design_org_code,drawing_number_id,
	        drawing_number_code,drawing_number_version,project_id,
            project_code_seq,change_number,drawing_detailed_state,
            drawing_detailed_type,parent_id,design_id,materials_id,design_code,
            design_describe,extra1,extra2,extra3,extra4,design_unit,
            design_count,used_count,error_message,drawing_number_device_no,
            unit_weight,total_weight,part_attributes,remark
		) values(
			#{drawingDetailedId}, #{drawingDetailedNo}, #{materialsTableId},
			#{materialsTableCode},#{designOrgId},#{designOrgCode}, #{drawingNumberId}, 
			#{drawingNumberCode},  #{drawingNumberVersion},#{projectId}, 
			#{projectCodeSeq}, #{changeNumber}, #{drawingDetailedState},
			#{drawingDetailedType},#{parentId},#{designId},#{materialsId},#{designCode},
			#{designDescribe}, #{extra1},#{extra2},, #{extra3},#{extra4}, #{designCount},
			#{usedCount}, #{overrun}, #{totalCount}, #{errorMessage}, #{drawingNumberDeviceNo},
			#{unitWeight}, #{totalWeight}, #{partAttributes}, #{remark}
		)
	</insert>
	
	<!-- 批量插入 -->
	<insert id="insertList" parameterType="java.util.List" useGeneratedKeys="false">
		insert into d_drawing_detailed(
	        drawing_detailed_id, drawing_detailed_no, materials_table_id,
	        materials_table_code, design_org_id, design_org_code, drawing_number_id,
	        drawing_number_code, drawing_number_version, project_id,
            project_code_seq, change_number, drawing_detailed_state,
            drawing_detailed_type, parent_id, design_id, materials_id, design_code,
            design_describe ,extra1, extra2, extra3, extra4, design_unit,
            design_count, used_count, error_message, drawing_number_device_no,
            overrun, total_count, error_type,
			unit_weight, total_weight, part_attributes, remark
		)
		SELECT A.*
		FROM(
		<foreach collection="list" item="item" index="index" separator="UNION ALL">
			(SELECT
				#{item.drawingDetailedId} drawing_detailed_id, #{item.drawingDetailedNo} drawing_detailed_no, #{item.materialsTableId} materials_table_id,
				#{item.materialsTableCode} materials_table_code, #{item.designOrgId} design_org_id, #{item.designOrgCode} design_org_code, #{item.drawingNumberId} drawing_number_id,
				#{item.drawingNumberCode} drawing_number_code, #{item.drawingNumberVersion} drawing_number_version, #{item.projectId} project_id,
				#{item.projectCodeSeq} project_code_seq, #{item.changeNumber} change_number, #{item.drawingDetailedState} drawing_detailed_state,
				#{item.drawingDetailedType} drawing_detailed_type, #{item.parentId} parent_id, #{item.designId} design_id, #{item.materialsId} materials_id, #{item.designCode} design_code,
				#{item.designDescribe} design_describe, #{item.extra1} extra1, #{item.extra2} extra2, #{item.extra3} extra3, #{item.extra4} extra4, #{item.designUnit} design_unit,
				#{item.designCount} design_count, #{item.usedCount} used_count, #{item.errorMessage} error_message, #{item.drawingNumberDeviceNo} drawing_number_device_no,
				#{item.overrun} overrun, #{item.totalCount} total_count, #{item.errorType} error_type,
				#{item.unitWeight} unit_weight, #{item.totalWeight} total_weight, #{item.partAttributes} part_attributes, #{item.remark} remark
			FROM dual)
		</foreach>
		)A 
	</insert>
	
	<!-- 更新一个实体 -->
	<update id="update" parameterType="DrawingDetailed">
		update d_drawing_detailed
		<set>
			drawing_detailed_no = #{drawingDetailedNo},
			<if test="materialsTableId!= null and materialsTableId !=''">materials_table_id = #{materialsTableId},</if>
			<if test="materialsTableCode!= null and materialsTableCode !=''">materials_table_code = #{materialsTableCode},</if>
			<if test="designOrgId!= null and designOrgId !=''">design_org_id = #{designOrgId},</if>
			<if test="designOrgCode!= null and designOrgCode !=''">design_org_code = #{designOrgCode},</if>
			<if test="drawingNumberId!= null and drawingNumberId !=''">drawing_number_id = #{drawingNumberId},</if>
			<if test="drawingNumberCode!= null and drawingNumberCode !=''">drawing_number_code = #{drawingNumberCode},</if>
			<if test="drawingNumberVersion!= null and drawingNumberVersion !=''">drawing_number_version = #{drawingNumberVersion},</if>
			<if test="projectId!= null and projectId !=''">project_id = #{projectId},</if>
			<if test="projectCodeSeq!= null and projectCodeSeq !=''">project_code_seq = #{projectCodeSeq},</if>
			<if test="changeNumber!= null and changeNumber !=''">change_number = #{changeNumber},</if>
			<if test="drawingDetailedState!= null and drawingDetailedState !=''">drawing_detailed_state = #{drawingDetailedState},</if>
			<if test="drawingDetailedType!= null and drawingDetailedType !=''">drawing_detailed_type = #{drawingDetailedType},</if>
			<if test="parentId!= null and parentId !=''">parent_id = #{parentId},</if>
			<if test="designId!= null and designId !=''">design_id = #{designId},</if>
			<if test="materialsId!= null and materialsId !=''">materials_id = #{materialsId},</if>
			design_code = #{designCode},
			design_describe = #{designDescribe},
			extra1 = #{extra1},
			extra2 = #{extra2},
			extra3 = #{extra3},
			extra4 = #{extra4},
			design_unit = #{designUnit},
			design_count = #{designCount},
			<if test="usedCount!= null and usedCount !=''">used_count = #{usedCount},</if>
			<if test="drawingNumberDeviceNo!= null and drawingNumberDeviceNo !=''">drawing_number_device_no = #{drawingNumberDeviceNo},</if>
			<if test="overrun!= null and overrun !=''">overrun = #{overrun},</if>
			<if test="totalCount!= null and totalCount !=''">total_count = #{totalCount},</if>
			unit_weight = #{unitWeight},
			total_weight = #{totalWeight},
			part_attributes = #{partAttributes},
			remark = #{remark},
			error_message = #{errorMessage},
			error_type = #{errorType}
		</set>
		where drawing_detailed_id = #{drawingDetailedId}
	</update>
	
	<!-- 物资 查找重复项 -->
	<select id="findRepeatW" resultType="string" parameterType="java.util.List">
		select to_char(drawing_number_code || ',' || drawing_detailed_no || ',' || drawing_number_version || ',' || design_org_id) as a from d_drawing_detailed
		where drawing_number_code is not null and error_type is null
		INTERSECT
		select * from(
		<foreach collection="list" item="item" index="index" separator="UNION ALL">
			(SELECT #{item} as a FROM dual)
		</foreach>
		)
	</select>

	<!-- 设备 查找重复项 -->
	<select id="findRepeatS" resultType="string" parameterType="java.util.List">
		select to_char(design_code || ',' || drawing_number_device_no) as a from d_drawing_detailed
		where drawing_detailed_type='s' and error_type is null
		INTERSECT
		select * from(
		<foreach collection="list" item="item" index="index" separator="UNION ALL">
			(SELECT #{item} as a FROM dual)
		</foreach>
		)
	</select>
	
	<!-- 返回匹配项Id列表 -->
	<select id="findMatching" resultMap="DrawingDetailedMap" parameterType="java.util.List">
		select * from d_drawing_detailed
		where 
		design_code || ',' || design_org_Id || ',' || design_describe || ',' ||
		extra1 || ',' || extra2 || ',' || extra3 || ',' || extra4 in (
			select to_char(design_code || ',' || design_org_Id || ',' || design_describe || ',' ||
	                	   additional_1 || ',' || additional_2 || ',' || additional_3 || ',' || additional_4) as a 
			from B_DESIGN_CODE se where se.isdel='1'
			INTERSECT
			select * from(
			<foreach collection="list" item="item" index="index" separator="UNION ALL">
				(SELECT to_char(#{item.designCode} || ',' || #{item.designOrgId} || ',' || #{item.designDescribe} || ',' ||
				 #{item.extra1}|| ',' || #{item.extra2}|| ',' || #{item.extra3}|| ',' || #{item.extra4}) as a FROM dual)
			</foreach>
			)
		)
	</select>
	
	<!-- 返回不匹配项Id列表 -->
	<select id="findMismatch" resultMap="DrawingDetailedMap" parameterType="java.util.List">
		select * from d_drawing_detailed
		where 
		design_code || ',' || design_org_Id || ',' || design_describe || ',' ||
		extra1 || ',' || extra2 || ',' || extra3 || ',' || extra4 in (
			select * from(
			<foreach collection="list" item="item" index="index" separator="UNION ALL">
				(SELECT to_char(#{item.designCode} || ',' || #{item.designOrgId} || ',' || #{item.designDescribe} || ',' ||
				#{item.extra1}|| ',' || #{item.extra2}|| ',' || #{item.extra3}|| ',' || #{item.extra4}) as a FROM dual)
			</foreach>
			)
			MINUS
			select to_char(design_code || ',' || design_org_Id || ',' || design_describe || ',' ||
	                	   additional_1 || ',' || additional_2 || ',' || additional_3 || ',' || additional_4) as a 
			from B_DESIGN_CODE se where se.isdel='1'
		)
	</select>

	<!-- 为已匹配的项目回填 -->
	<update id="makeInformationComplete" parameterType="DrawingDetailed">
		update d_drawing_detailed dd
		set (dd.design_id, dd.materials_id, dd.drawing_detailed_state)  = (
			select
			design_code_id, system_code_id,
			(case when ismatching = '1' then 'alreadyMatch' when ismatching = '0' then 'notMatch' end)
			from B_DESIGN_CODE
			where isdel='1' and
			design_code || ',' || design_org_Id || ',' || design_describe || ',' ||
			additional_1 || ',' || additional_2 || ',' || additional_3 || ',' || additional_4
			= （select to_char(#{designCode} || ',' || #{designOrgId} || ',' || #{designDescribe} || ',' ||
					          #{extra1}|| ',' || #{extra2}|| ',' || #{extra3}|| ',' || #{extra4}) from dual）
		)
		where dd.drawing_detailed_id = #{drawingDetailedId}
	</update>
	
	<!-- 根据错误类型与料表检索错误信息 -->
	<select id="selectByErrorType" resultMap="DrawingDetailedMap" parameterType="map">
		select * from d_drawing_detailed
		<where>
			materials_table_id = #{DrawingDetailedCondition.materialsTableId}
			<if test="DrawingDetailedCondition.errorType != null and DrawingDetailedCondition.errorType != ''">
				and error_type = #{DrawingDetailedCondition.errorType}
			</if>
		</where>
	</select>
	
	<!-- 查询未匹配项列表 -->
	<select id="selectNotConform" resultMap="DrawingDetailedMap" parameterType="map">
		select dd.drawing_detailed_id,dd.drawing_detailed_no,dd.materials_table_id,
		dd.materials_table_code,dd.design_org_id,dd.design_org_code,dd.drawing_number_id,
		dd.drawing_number_code,dd.drawing_number_version,dd.project_id,
		b.project_code_seq,dd.change_number,dd.drawing_detailed_state,
		dd.drawing_detailed_type,dd.parent_id,dd.design_id,dd.materials_id,dd.design_code,
		dd.design_describe,dd.extra1,dd.extra2,dd.extra3,dd.extra4,dd.design_unit,
		dd.design_count,dd.used_count,dd.error_message,dd.drawing_number_device_no,
		dd.overrun, dd.total_count, dd.error_type,
		dd.unit_weight, dd.total_weight, dd.part_attributes, dd.remark
		from d_drawing_detailed dd
		left join b_project b
		on dd.project_id=b.project_id
		<where>
			(drawing_detailed_state = 'notMatch' or drawing_detailed_state IS NULL)
			<if test="DrawingDetailedCondition.materialsTableId!=null and DrawingDetailedCondition.materialsTableId!=''">
				and dd.materials_table_id = #{DrawingDetailedCondition.materialsTableId}
			</if>
		</where>
	</select>

	<!-- 直达现场检验物资是否存在 -->
	<select id="checkStoNo" parameterType="map" resultType="int">
		select count(*)
		from d_drawing_detailed dd
		<where>
			1=1
			<if test="DrawingDetailedCondition.wbsId!=null and DrawingDetailedCondition.wbsId!=''" >
				and dd.wbs_id = #{DrawingDetailedCondition.wbsId}
			</if>
			<if test="DrawingDetailedCondition.drawingNumberDeviceNo!=null and DrawingDetailedCondition.drawingNumberDeviceNo!=''" >
				and dd.drawing_number_device_no = #{DrawingDetailedCondition.drawingNumberDeviceNo}
			</if>
			<if test="DrawingDetailedCondition.materialsId!=null and DrawingDetailedCondition.materialsId!=''" >
				and dd.materials_id = #{DrawingDetailedCondition.materialsId}
			</if>
		</where>
	</select>
	<!-- 根据ID删除条目 -->
	<delete id="delete" parameterType="string">
		delete from d_drawing_detailed where drawing_detailed_id = #{drawingDetailedId}
	</delete>

	<!-- 根据料表id删除图号明细 -->
	<delete id="deleteByMTid" parameterType="string">
		delete from d_drawing_detailed where materials_table_id = #{materialsTableId}
	</delete>

	<!-- 根据设备id删除部件 -->
	<delete id="deletePartsBySid" parameterType="string">
		delete from d_drawing_detailed where parent_id = #{materialsTableId}
	</delete>
	<select id="selectByEquipmentId" resultMap="DrawingDetailedMap" parameterType="string">
		select * from d_drawing_detailed where parent_id = #{drawingDetailedId}
	</select>
	<select id="selectByPk" resultMap="DrawingDetailedMap" parameterType="string">
		select * from d_drawing_detailed where drawing_detailed_id = #{drawingDetailedId}
	</select>
</mapper>