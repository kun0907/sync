<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="InWarehouse">
        <resultMap id="inWarehouseMap" type="InWarehouse">
                <id column="in_warehouse_id"  property="inWarehouseId"/>
                <result column="in_warehouse_code"  property="inWarehouseCode"/>
                <result column="supplier_id"  property="supplierId"></result>
                <result column="supplier_name"  property="supplierName"></result>
                <result column="in_warehouse_state"  property="inWarehouseState"/>
                <result column="order_id"  property="orderId"/>
                <result column="order_code"  property="orderCode"/>
                <result column="create_time" property="createTime"/>
                <result column="create_user_id" property="createUserId"/>
                <result column="create_user_name" property="createUserName"/>
                <result column="in_warehouse_time" property="inWarehouseTime"/>
                <result column="in_worker" property="inWorker"/>
       </resultMap>
        <!-- 根据条件查询条目 -->
        <select id="selectByCondition" resultMap="inWarehouseMap" parameterType="map">
                select *
                from (SELECT a.in_warehouse_id,
                a.in_warehouse_code,
                a.supplier_id,
                a.supplier_name,
                dic.dictionary_name as in_warehouse_state,
                a.order_id,
                a.order_code,
                a.create_time,
                a.in_warehouse_time,
                a.create_user_id,
                a.create_user_name,
                ROW_NUMBER() OVER(order by a.create_time desc) r
                from RU_IN_WAREHOUSE a
                left join sys_dictionary dic
                on dic.dictionary_code = a.in_warehouse_state
                <where>
                        <if test="InWarehouseCondition!=null">
                                <if test="InWarehouseCondition.inWarehouseCode!=null and InWarehouseCondition.inWarehouseCode!=''">
                                        AND in_warehouse_code like  '%'|| #{InWarehouseCondition.inWarehouseCode} || '%'
                                </if>
                                <if test="InWarehouseCondition.supplierName!=null and InWarehouseCondition.supplierName!=''">
                                        AND supplier_name=#{InWarehouseCondition.supplierName}
                                </if>
                                <if test="InWarehouseCondition.inWarehouseState!=null and InWarehouseCondition.inWarehouseState!=''">
                                        AND in_warehouse_state=#{InWarehouseCondition.inWarehouseState}
                                </if>
                                <if test="InWarehouseCondition.createUserName!=null and InWarehouseCondition.createUserName!=''">
                                        AND create_user_name=#{InWarehouseCondition.createUserName}
                                </if>
                            <if test="InWarehouseCondition.createStartTime!=null ">
                                and a.create_time &gt;= #{InWarehouseCondition.createStartTime}
                            </if>
                            <if test="InWarehouseCondition.createEndTime!=null ">
                                and a.create_time &lt;= #{InWarehouseCondition.createEndTime}
                            </if>
                            <if test="InWarehouseCondition.inWarehouseStartTime!=null ">
                                and a.in_warehouse_time &gt;= #{InWarehouseCondition.inWarehouseStartTime}
                            </if>
                            <if test="InWarehouseCondition.inWarehouseEndTime!=null ">
                                and a.in_warehouse_time &lt;= #{InWarehouseCondition.inWarehouseEndTime}
                            </if>
                        </if>
                </where>
                ) s  where s.r between #{page.startPos} and ((#{page.pageSize}+#{page.startPos})-1)
        </select>

        <select id="countByCondition" resultType="int" parameterType="map">
                select count(*)
                FROM RU_IN_WAREHOUSE a
                left join sys_dictionary dic
                on dic.dictionary_code = a.in_warehouse_state
            <where>
                <if test="InWarehouseCondition!=null">
                    <if test="InWarehouseCondition.inWarehouseCode!=null and InWarehouseCondition.inWarehouseCode!=''">
                        AND in_warehouse_code like  '%'|| #{InWarehouseCondition.inWarehouseCode} || '%'
                    </if>
                    <if test="InWarehouseCondition.supplierName!=null and InWarehouseCondition.supplierName!=''">
                        AND supplier_name=#{InWarehouseCondition.supplierName}
                    </if>
                    <if test="InWarehouseCondition.inWarehouseState!=null and InWarehouseCondition.inWarehouseState!=''">
                        AND in_warehouse_state=#{InWarehouseCondition.inWarehouseState}
                    </if>
                    <if test="InWarehouseCondition.createUserName!=null and InWarehouseCondition.createUserName!=''">
                        AND create_user_name=#{InWarehouseCondition.createUserName}
                    </if>
                    <if test="InWarehouseCondition.createStartTime!=null ">
                        and a.create_time &gt;= #{InWarehouseCondition.createStartTime}
                    </if>
                    <if test="InWarehouseCondition.createEndTime!=null ">
                        and a.create_time &lt;= #{InWarehouseCondition.createEndTime}
                    </if>
                    <if test="InWarehouseCondition.inWarehouseStartTime!=null ">
                        and a.in_warehouse_time &gt;= #{InWarehouseCondition.inWarehouseStartTime}
                    </if>
                    <if test="InWarehouseCondition.inWarehouseEndTime!=null ">
                        and a.in_warehouse_time &lt;= #{InWarehouseCondition.inWarehouseEndTime}
                    </if>
                </if>
            </where>
        </select>

        <!-- 根据主键查询框架协议信息 -->
        <select id="selectByPk" resultMap="inWarehouseMap" parameterType="string">
                select *
                FROM RU_IN_WAREHOUSE
                where
                in_warehouse_id = #{inWarehouseId}
        </select>


        <insert id="insert" parameterType="InWarehouse" useGeneratedKeys="false">
         insert into RU_IN_WAREHOUSE(
                 in_warehouse_id,in_warehouse_code,order_id,order_code,supplier_id,supplier_name,in_warehouse_state,create_time,in_warehouse_time,create_user_name,in_worker)
                 VALUES (
                #{inWarehouseId}, #{inWarehouseCode},#{orderId},#{orderCode},#{supplierId},#{supplierName},#{inWarehouseState},#{createTime},#{inWarehouseTime},#{createUserName},#{inWorker}
                 )

        </insert>


        <update id="update" parameterType="InWarehouse" >
                update  RU_IN_WAREHOUSE
                <set> in_warehouse_code=#{inWarehouseCode},order_code=#{orderCode},supplier_name=#{supplierName},
                        in_warehouse_state=#{inWarehouseState},in_warehouse_time=#{inWarehouseTime},
                       in_worker=#{inWorker}
                </set>
                where in_warehouse_id = #{inWarehouseId}
        </update>


        <delete id="delete" parameterType="string">
                delete  from RU_IN_WAREHOUSE
                <where>
                        in_warehouse_id = #{inWarehouseId}
                </where>
        </delete>


</mapper>