<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="TransportInfo">
    <resultMap type="TransportInfo" id="transportInfoMap">
        <id column="transport_info_id" property="transportInfoId"/>
        <result column="ji_gang_id" property="jiGangId"/>
        <result column="transport_info_details_id" property="transportInfoDetailsId"/>
        <result column="transport_no" property="transportNo"/>
        <result column="inspect_staus" property="inspectStaus"/>
        <result column="create_time" property="createTime"/>
        <result column="create_user_name" property="createUserName"/>
        <result column="ji_gang_site" property="jiGangSite"/>
        <result column="ji_gang_time" property="jiGangTime"/>
    </resultMap>
    <!-- 根据条件分页查询条目 -->
    <select id="selectByCondition" resultMap="transportInfoMap" parameterType="map">
        select * from(
        select
        transport_info_id,ji_gang_id,transport_info_details_id,transport_no,
        inspect_staus,create_user_name,ROW_NUMBER() OVER(order by create_time desc) r
        from
        p_transport_info pti
        <where>
            <if test="TransportInfoCondition!=null">
                <if test="TransportInfoCondition.transportNo != null and TransportInfoCondition.transportNo != ''">
                    and transport_no = #{TransportInfoCondition.transportNo}
                </if>
                <if test="TransportInfoCondition.inspectStaus != null and TransportInfoCondition.inspectStaus != ''">
                    and inspect_staus = #{TransportInfoCondition.inspectStaus}
                </if>
                <if test="TransportInfoCondition.jiGangSite != null and TransportInfoCondition.jiGangSite != ''">
                    and ji_gang_site = #{TransportInfoCondition.jiGangSite}
                </if>
                <if test="TransportInfoCondition.jiGangSite != null and TransportInfoCondition.jiGangSite != ''">
                    and ji_gang_time = #{TransportInfoCondition.jiGangTime}
                </if>
            </if>
        </where>
        )s
        where  s.r between #{page.startPos} and ((#{page.pageSize}+#{page.startPos})-1)
    </select>

    <!-- 根据条件查询条目数 -->
    <select id="countByCondition" resultType="int" parameterType="map">
        select count(*)
        from
        p_transport_info pti
        <where>
            <if test="TransportInfoCondition!=null">
                <if test="TransportInfoCondition.transportNo != null and TransportInfoCondition.transportNo != ''">
                    and transport_no = #{TransportInfoCondition.transportNo}
                </if>
                <if test="TransportInfoCondition.inspectStaus != null and TransportInfoCondition.inspectStaus != ''">
                    and inspect_staus = #{TransportInfoCondition.inspectStaus}
                </if>
                <if test="TransportInfoCondition.jiGangSite != null and TransportInfoCondition.jiGangSite != ''">
                    and ji_gang_site = #{TransportInfoCondition.jiGangSite}
                </if>
                <if test="TransportInfoCondition.jiGangSite != null and TransportInfoCondition.jiGangSite != ''">
                    and ji_gang_time = #{TransportInfoCondition.jiGangTime}
                </if>
            </if>
        </where>
    </select>
    <delete id="delete" parameterType="string">
        delete from p_transport_info pti where transport_info_id = #{transportInfoId}
    </delete>
    <!-- 根据ID查询单个实体 -->
    <select id="selectByPk" resultMap="transportInfoMap" parameterType="string">
        select * from p_transport_info where transport_info_id = #{transportInfoId}
    </select>
    <!-- 编辑 -->
    <update id="update" parameterType="TransportInfo">
        update p_transport_info
        <set>
            transport_info_id = #{transportInfoId}, ji_gang_id = #{jiGangId},
            transport_info_details_id = #{transportInfoDetailsId}, ji_gang_site = #{jiGangSite},
            ji_gang_time = #{jiGangTime,jdbcType=TIMESTAMP},create_time = #{createTime,jdbcType=TIMESTAMP},create_user_name = #{createUserName},
            <if test="inspectStaus!=null and inspectStaus!=''">inspect_staus = #{inspectStaus},</if>
        </set>
        where transport_info_id = #{transportInfoId}
    </update>
    <!-- 插入仓库信息 -->
    <insert id="insert" parameterType="TransportInfo" useGeneratedKeys="false">
        insert into p_transport_info (
        transport_info_id,ji_gang_id,transport_info_details_id,ji_gang_site,
        ji_gang_time,inspect_staus,transport_no,
        create_time,create_user_name
        ) values (
        #{transportInfoId},#{jiGangId},
        #{transportInfoDetailsId},#{jiGangSite},
        #{jiGangTime,jdbcType=TIMESTAMP},#{inspectStaus},#{transportNo},
        #{createTime,jdbcType=TIMESTAMP},#{createUserName}
        )
    </insert>

</mapper>