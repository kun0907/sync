<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ProcessRecordDetail">
    <resultMap type="ProcessRecordDetail" id="processRecordDetailMap">
        <id column="record_detail_id" property="RecordDetailId"/>
        <result column="process_record_id" property="precessRecordId"/>
        <result column="approve_time" property="approveTime"/>
        <result column="approve_user_id" property="approveUserId"/>
        <result column="approve_user_name" property="approveUserName"/>
        <result column="is_approve" property="isApprove"/>
        <result column="process_detail_id" property="processDetailId"/>
        <result column="role_id" property="roleId"/>
        <result column="role_name" property="roleName"/>
        <result column="sequence" property="sequence"/>
    </resultMap>
    <insert id="insertList" parameterType="java.util.List" useGeneratedKeys="false">
        insert into sys_process_record_detail
        (record_detail_id,process_record_id,
        approve_time,approve_user_id,
        approve_user_name,is_approve,process_detail_id
        )
        SELECT A.*
        FROM(
        <foreach collection="list" item="item" index="index" separator="UNION ALL">
            (SELECT
            #{item.RecordDetailId} record_detail_id,#{item.precessRecordId} process_record_id,
            #{item.approveTime} approve_time,#{item.approveUserId} approve_user_id,
            #{item.approveUserName} approve_user_name,#{item.isApprove} is_approve,#{item.processDetailId} process_detail_id
            FROM dual)
        </foreach>
        )A
    </insert>
    <select id="selectByParentId" resultMap="processRecordDetailMap" parameterType="string">
        select record.record_detail_id,record.process_record_id,record.approve_time,record.approve_user_id,
        record.approve_user_name,record.is_approve,record.process_detail_id,pro.role_id,pro.sequence,ro.role_name
         from sys_process_record_detail record
        left join sys_process_detail pro on record.process_detail_id=pro.process_detail_id
         left join sys_role ro on pro.role_id=ro.role_id
         where process_record_id = #{id} order by pro.sequence
    </select>
    <update id="update">
        update sys_process_record_detail
        <set>
            approve_time = #{approveTime},approve_user_id = #{approveUserId},
            approve_user_name = #{approveUserName},is_approve = #{isApprove}
        </set>
        where record_detail_id = #{RecordDetailId}
    </update>
</mapper>