<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="Tallying" >
  <resultMap id="TallyingMap" type="Tallying" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Mar 25 12:15:10 CST 2017.
    -->
    <id column="tallying_id" property="tallyingId" jdbcType="OTHER" />
    <result column="tallying_num" property="tallyingNum" jdbcType="DECIMAL" />
    <result column="tallying_date" property="tallyingDate" jdbcType="TIMESTAMP" />
    <result column="tallying_user" property="tallyingUser" jdbcType="VARCHAR" />
    <association property="pickNotice" column="pick_notice" select="PickNotice.selectByPk"/>
    <association property="pickNoticeDetail" column="pick_notice_detail" select="PickNoticeDetail.selectByPk"/>
    <association property="materials" column="materials" select="Materials.selectByPk"/>
    <association property="wbs" column="wbs" select="Project.selectByPk"/>
    <association property="contractor" column="contractor" select="Organization.selectByPk"/>
    <association property="storagelocation" column="storagelocation" select="Storagelocation.selectByPk"/>
  </resultMap>

  <!-- 批量插入组织机构类型表 -->
  <insert id="insertList" parameterType="java.util.List" useGeneratedKeys="false">
    insert into out_tallying
    (tallying_id,wbs,contractor,materials,tallying_num,tallying_date,tallying_user,pick_notice,pick_notice_detail,storagelocation)
    SELECT A.*
    FROM(
    <foreach collection="list" item="item" index="index" separator="UNION ALL">
      (SELECT
      #{item.tallyingId,jdbcType=VARCHAR} tallying_id,
      #{item.wbs.projectId,jdbcType=VARCHAR} wbs,
      #{item.contractor.orgId,jdbcType=VARCHAR} contractor,
      #{item.materials.materialsId,jdbcType=VARCHAR} materials,
      #{item.tallyingNum,jdbcType=CHAR} tallying_num,
      #{item.tallyingDate,jdbcType=CHAR} tallying_date,
      #{item.tallyingUser,jdbcType=CHAR} tallying_user,
      #{item.pickNotice.pickId,jdbcType=CHAR} pick_notice,
      #{item.pickNoticeDetail.pickDetailId,jdbcType=CHAR} pick_notice_detail,
      #{item.storagelocation.storagelocationId,jdbcType=CHAR} storagelocation
      FROM dual)
    </foreach>
    )A
  </insert>

  <select id="queryTallyList" resultMap="TallyingMap">
    select * from out_tallying ot
    <where>
      ot.is_out = '0'
    </where>
  </select>

  <delete id="delete" parameterType="string">
    delete from out_tallying ot
    <where>
      ot.tallying_id = #{tallyingId}
    </where>
  </delete>

  <select id="selectByPk" parameterType="string" resultMap="TallyingMap">
    select * from out_tallying ot
    <where>
      ot.tallying_id = #{tallyingId}
    </where>
  </select>
  
  <update id="update">
    update out_tallying ot
    <set>
      <if test="isOut!= null and isOut!=''">is_out = #{isOut},</if>
      ot.tallying_id = #{tallyingId}
    </set>
    <where>
      ot.tallying_id = #{tallyingId}
    </where>
  </update>
</mapper>