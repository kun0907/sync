<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="DemandDrawing" >
       <resultMap type="DemandDrawing" id="demandDrawingMap">
              <id column="drawing_id" property="drawingId"/>
              <result column="wbs_id" property="wbsId"/>
              <result column="design_code" property="designCode"/>
              <result column="materials_id" property="materialsId"/>
              <result column="drawing_number_code" property="drawingNumberCode"/>
              <result column="drawing_number_version" property="drawingNumberVersion"/>
              <result column="design_count" property="designCount"/>
              <result column="demand_count" property="demandCount"/>
       </resultMap>
       <!-- 插入需用计划信息 -->
       <insert id="insert" parameterType="demandDrawing" useGeneratedKeys="false">
              insert into out_demand_drawing (
              drawing_id,wbs_id,
              design_code,materials_id,
              drawing_number_code,drawing_number_version,
              design_count,demand_count
              ) values (
              #{drawingId},#{wbsId},
              #{designCode},#{materialsId},
              #{drawingNumberCode},#{drawingNumberVersion},
              #{designCount},#{demandCount}
              )
       </insert>
       <select id="selectByDemand" resultMap="demandDrawingMap" parameterType="map">
              select * from(
              select
              drawing_id,design_count,demand_count,
              ROW_NUMBER() OVER(order by od.drawing_id) r
              from
              out_demand_drawing od
              <where>
                     1=1
                     <if test="wbsId != null and wbsId != ''">
                            and wbs_id = #{wbsId}
                     </if>
                     <if test="designCode != null and designCode != ''">
                            and design_code = #{designCode}
                     </if>
                     <if test="materialsId != null and materialsId != ''">
                            and materials_id = #{materialsId}
                     </if>
                     <if test="drawingNumberCode != null and drawingNumberCode != ''">
                            and drawing_number_code = #{drawingNumberCode}
                     </if>
                     <if test="drawing_number_version != null and drawingNumberVersion != ''">
                            and drawing_number_code = #{drawingNumberVersion}
                     </if>
              </where>
              )s
       </select>
       <update id="update" parameterType="DemandDrawing">
              update out_demand_drawing
              <set>
                     demand_count = #{demandCount}
              </set>
              where drawing_id = #{drawingId}
       </update>
</mapper>